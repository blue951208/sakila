<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>출현한 배우 리스트</title>
<script src="/jquery-ex/scripts/jquery-3.4.1.min.js"></script>
</head>
<style>
    body {
        padding: 0;
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background-position: 0 0;
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-size: cover;
        position: relative;
        overflow-y: auto;
    }
    
    #aside {
        width: 200px;
        height: 3000px;
        position: fixed;
        background: orange;
        overflow: hidden;
        float: left;
    }
    
    #section {
        margin-left: 300px;
        margin-right: 500px;
        margin-bottom: 100px;
        background: white;
    }
</style>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
<body>
	 <div id="aside">
        <h1>MENU</h1>
			<ul>
        		<li>
        		<div class="dropdown" id="adminMenu">
        			<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
        				관리자 메뉴
        			</button>
	        			<div class="dropdown-menu">
	        				<a class="dropdown-item" href="">Country 관리</a>
	        				<a class="dropdown-item" href="/sakila/insertRentalForm.html">대여 관리</a>
	        				<a class="dropdown-item" href="/sakila/insertFilmForm.html">영화 입력</a>
	        			</div>
        			</div>
        		</li>
        		<!-- <a href="/sakila/customerList.html">Customer 관리</a> -->
        		<li><a href="/sakila/businessList.html">Business 관리</a></li>
        		<li><a href="/sakila/inventoryList.html">Inventory 관리</a></li>
        		<!-- 배우 목록  -->
        		<li><a href="/sakila/actorList.html">배우</a></li>
        	</ul>
    </div>
    <div id="section" class="container">
     <div class="row">
			<div class="col-sm-1">
				<h1>INDEX</h1>
			</div>        	
        	<div class="col-sm-10"></div>
        	<div class="col-sm-1">
    			<a href="/sakila/login.html">로그인</a>
        		<button type="button" id="logout">로그아웃</button>
        	</div>
        </div>	
        <h1>배우들....</h1>
	
		Actor:<input type="text" id="actorName" class="form-control">
			<button id="actorFilm" class="btn btn-outline-warning">검색</button>
	
			<table border="1" id="list" class="table table-striped">
					<thead>
						<tr>
							<td>제목</td>
							<td>설명</td>
							<td>개봉년도</td>
						</tr>	
					</thead>
					<tbody id="filmList">
					</tbody>
			</table>
	<div id="actor">
		<table border="1" class="table table-striped">
			<thead>
				<tr>
					<td>번호</td>
					<td>배우 이름</td>
				</tr>
			</thead>
			<tbody id="actorList">
			
			</tbody>
		</table>
		 	<button id="aprev" class="btn btn-outline-warning">이전</button>
		 	
		 	<button id="anext" class="btn btn-outline-warning">다음</button>
 	</div>
    </div>

</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
	$("#adminMenu").hide();
	let loginState;
	$.ajax({
		url:"/sakila/SessionCheck",
		method:"post",
		success:function(json){
			loginState = json;
			if(loginState!=null){
				console.log(loginState);
				$("#adminMenu").show();
				$("#login").hide();
				$("#logout").show();
			}else{
				$("#adminMenu").hide();
				$("#logout").hide();
				$("#login").show();
			}
		}
	})
	
	$("#logout").click(function(){
		$.ajax({
			url:"/sakila/logout",
			method:"post",
			success:function(){
				location.href = "/sakila/index.html";
				return false;//function 종료 
			}
		})
	})

	let currentPage=1;
	let lastPage=0;
	
	 $.ajax({
			url:"/sakila/getLastPage",
			method:"post",
			success:function(json){
				console.log(json.lastPage); 
				lastPage = json.lastPage;
			}
		})
	
	$("#list").hide();
	 $.ajax({
		url:"/sakila/getActorList",
		method:"post",
		data:{
			"currentPage":currentPage
		},
		success:function(json){
			console.log("리스트 체크"+json);
			//json을 배열로 변환
		//	let paging = eval(json);
			//console.log(paging);
			$(json).each(function(index,item){
				$("#actorList").append(
						"<tr><td class='id'>"+item.actorId+"</td>"
						+"<td>"+item.name+"</a></td>"
						+"</tr>"
						);
			})
		}
	 })
	 
	 //이전버튼
	
		 $("#aprev").click(function(){
			 $("#actorList").empty();
			 currentPage-=1;
			 console.log(currentPage)
			 $.ajax({
				url:"/sakila/getActorList",
				method:"post",
				data:{
					"currentPage":currentPage
				},
			 	success:function(json){
					console.log("리스트 체크"+json);
					$(json).each(function(index,item){
						$("#actorList").append(
								"<tr><td class='id'>"+item.actorId+"</td>"
								+"<td>"+item.name+"</a></td>"
								+"</tr>"
								);
					})
				}
			 }) 
		 })
	/*if(currentPage==1){
		$("#aprev").hide();
	}else{
		$("#aprev").show();
	}			

		if(currentPage==lastPage){
			$("#anext").hide();
		}else{
			$("#anext").show();
		}*/
			 $("#anext").click(function(){
				 $("#actorList").empty();
				 currentPage+=1;
				 $.ajax({
					url:"/sakila/getActorList",
					method:"post",
					data:{
						"currentPage":currentPage
					},
				 	success:function(json){
						console.log("page-"+currentPage);
						$(json).each(function(index,item){
							$("#actorList").append(
									"<tr><td class='id'>"+item.actorId+"</td>"
									+"<td>"+item.name+"</a></td>"
									+"</tr>"
									);
						})
					}
				 }) 
			 })
		
		
	 $("#actorFilm").click(function(){
		 $("#list").show();
		 $("#filmList").empty();
		let actorName=$("#actorName").val();
		console.log("name:"+actorName);
				$.ajax({
					url:"/sakila/SelectActorOne",
					method:"post",
					data:{
						"name":actorName
						},
					success:function(json){
						console.log(json);
						$("#actor").empty();
						$(json).each(function(index,item){
							$("#filmList").append(
									"<tr>"
									+"<td>"+item.title+"</td>"
									+"<td>"+item.description+"</td>"
									+"<td>"+item.releaseYear+"</td>"
									+"</tr>"
							)
						});
					}
				})
		})	
		 
	
</script>
</html>